---
title: Apollo通信模型
createTime: 2025/10/05 22:56:00
permalink: /LearningRoute/bvb3h5i0/
---
## Apollo 客户端服务端通信模型

客户端有两种获取到配置的方式

1. 服务端告知方式：

2. 客户端和服务端保持了一个**长连接**，从而能第一时间获得配置更新的推送。（通过**Http Long Polling**实现），长连接的超时时间是60s，会返回一个304。

3. 开发者在AdminService修改配置，ConfigService有个每秒扫描的定时线程，监听数据库实现的消息队列，获取到变动的消息。此时会直接返回新的配置信息。

4. 客户端主动拉取：

5. 客户端有个兜底机制，每隔5分钟会主动向服务端拉最新的配置。

## Http Long Polling是什么，怎么实现的

HTTP Long Polling 是一种常用的保持客户端与服务器之间**长时间连接**的技术，它能够**在传统的请求/响应模型中模拟服务器推送消息的行为**。Long Polling 允许服务器在有数据时立即响应请求，如果没有数据，则等待一段时间直到数据可用或超时为止。

它的操作方式如下：

* 客户端发送一个 HTTP 请求（这可以是长连接或短连接）。

* 服务器保持连接打开直到有数据可返回（或超时），然后返回响应并关闭连接。

* 客户端接收到响应后，无论结果如何，都会立即重新建立一个新的 HTTP 请求，开始新的轮询周期。

本质上HTTP Long Polling是短连接。虽然发起的HTTP连接可能是长连接或者短连接形式的。但Long Polling每次当服务端返回之后都会关闭连接，不会保持这次连接，没有利用到长连接的复用TCP的特性。

## 贡献者

<div class="contributors-list" style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 20px;">
  <!-- 贡献者 1 -->    
  <div style="text-align: center;">
    <img src="https://avatars.githubusercontent.com/u/94302726?v=4" alt="魏知乐" style="width: 80px; border-radius: 50%;" />
    <p style="margin-top: 8px;"><a href="https://github.com/spaceluke" target="_blank">魏知乐</a></p>
  </div>

</div>