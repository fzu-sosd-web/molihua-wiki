---
title: 内存管理
createTime: 2025/10/05 23:09:48
permalink: /ComputerFundamentals/wmbrh8qr/
---
## 虚拟内存的好处

可以起到隔离的作用，进程间内存不会互相影响。

## 内存分页

基本单位是Page页，大小一般为4KB

虚拟内存和物理内存之间用页表来映射。

虚拟内存分为两部分：页号+页内偏移。

页号用于从**页表**处转换到物理地址，页表的结构为 虚拟页号+物理页号

### 内存地址的转换过程

1. 虚拟内存地址 → 页号+偏移量

2. 根据页号从页表得到物理页地址

3. 物理页地址+偏移量 → 物理内存地址

### 多级页表为什么可以节省内存

单级页表的情况下，os给每个进程分配页表空间时，不知道进程到底会怎么访问主存，所以会分配一个可以包括所有页表项的空间，32位os，会分配4MB大小的内存。进程一多，就十分浪费内存空间。（4MB = 2 ^ 32 B全部空间 / 4KB页大小 \* 4B32位页表项大小 = 1M \* 4B = 4MB），放到64位系统中，更是灾难。

多级页表可以解决这个问题，一级页表就可以覆盖整个虚拟内存空间，但是内存占用很小。如果一级页表中的一个项没有被用到，也就不用创建对应的二级页表了，可以在需要的时候再创建二级页表。

### TLB

多级页表可以节省内存空间，但是带来的成本就是要多做几次转换。为了加速这个过程，在CPU中有个专门存放页表项的Cache，就是TLB，快表。

CPU里面会封装一个MMU芯片，寻址的时候先查TLB，没找到才去找常规的页表。

进程切换会导致TLB失效，要重新从内存中读取页表，线程切换则不用。因此进程切换的代价较大。

## 贡献者

<div class="contributors-list" style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 20px;">
  <!-- 贡献者 1 -->    
  <div style="text-align: center;">
    <img src="https://avatars.githubusercontent.com/u/94302726?v=4" alt="魏知乐" style="width: 80px; border-radius: 50%;" />
    <p style="margin-top: 8px;"><a href="https://github.com/spaceluke" target="_blank">魏知乐</a></p>
  </div>

</div>